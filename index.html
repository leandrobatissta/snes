<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <title>SNES Web ‚Äì Super Mario World</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{margin:0;background:#111;color:#eee;font:14px/1.4 system-ui}
    header,footer{padding:12px 16px}
    header{border-bottom:1px solid #222}
    .wrap{max-width:980px;margin:0 auto;padding:16px}
    .row{display:flex;flex-wrap:wrap;gap:12px;align-items:center}
    button,input[type=file]{background:#222;border:1px solid #333;color:#eee;
      padding:8px 12px;border-radius:8px;cursor:pointer}
    button:hover{border-color:#555}
    #gameHost{width:100%;max-width:960px;aspect-ratio:4/3;background:#000;
      margin:12px auto;border-radius:8px;overflow:hidden;border:1px solid #222}
    #game{width:100%;height:100%}
    details{background:#0d0d0d;border:1px solid #222;border-radius:8px;padding:10px}
    summary{cursor:pointer;color:#ddd}
    small{opacity:.7}
    .spacer{flex:1}
  </style>
</head>
<body>
  <header class="wrap">
    <div class="row">
      <strong>SNES Web</strong>
      <span class="spacer"></span>
      <small>ROM padr√£o: <code>smw.sfc</code></small>
    </div>
  </header>

  <main class="wrap">
    <div class="row">
      <label>
        <input id="romInput" type="file" accept=".smc,.sfc,.zip,.7z" />
        Carregar ROM‚Ä¶
      </label>
      <button id="btnSave">üíæ Salvar</button>
      <button id="btnLoad">üìÇ Carregar</button>
      <button id="btnExport">‚¨áÔ∏è Baixar Save</button>
      <button id="btnImport">‚¨ÜÔ∏è Importar Save</button>
      <input id="stateInput" type="file" accept=".state" style="display:none" />
      <span class="spacer"></span>
      <button id="btnPause">‚èØÔ∏è Pausar</button>
      <button id="btnFullscreen">‚õ∂ Tela cheia</button>
    </div>

    <div id="gameHost">
      <div id="game"></div>
    </div>
  </main>

  <footer class="wrap">
    <small>SNES EmulatorJS ‚Ä¢ ROM padr√£o: <code>smw.sfc</code> na mesma pasta</small>
  </footer>

  <script>
    // Configura√ß√µes do emulador
    window.EJS_player = "#game";
    window.EJS_core = "snes";
    window.EJS_pathtodata = "https://cdn.emulatorjs.org/stable/data/";
    window.EJS_gameUrl = "smw.sfc";   // ROM padr√£o
    window.EJS_gameName = "Super Mario World";

    const LS_KEY = "snes_web_slot0_state";
    const msg = (t) => console.log("[SNES]", t);

    // Inicia o emulador automaticamente
    function startEmu(){
      const s = document.createElement("script");
      s.src = "https://cdn.emulatorjs.org/stable/data/loader.js";
      document.body.appendChild(s);
    }
    startEmu();

    // Carregar ROM manual
    document.getElementById("romInput").addEventListener("change", async (ev) => {
      const file = ev.target.files?.[0];
      if (!file) return;
      const buf = await file.arrayBuffer();
      window.EJS_gameUrl = new Uint8Array(buf);
      window.EJS_gameName = file.name;
      if (window.EJS_terminate) { try { window.EJS_terminate(); } catch(e){} }
      startEmu();
    });

    // Pausar / Retomar
    document.getElementById("btnPause").onclick = () => {
      const emu = window.EJS_emulator;
      if (!emu) return;
      if (emu.isPaused()) { emu.resume(); msg("‚ñ∂ Retomado"); }
      else { emu.pause(); msg("‚è∏Ô∏è Pausado"); }
    };

    // Tela cheia
    document.getElementById("btnFullscreen").onclick = () => {
      const host = document.getElementById("gameHost");
      if (document.fullscreenElement) document.exitFullscreen();
      else host.requestFullscreen().catch(()=>{});
    };

    // Salvar no navegador
    document.getElementById("btnSave").onclick = () => {
      const gm = window.EJS_emulator?.gameManager;
      if (!gm?.getState) return msg("Jogo n√£o iniciado.");
      try {
        const state = gm.getState();
        localStorage.setItem(LS_KEY, btoa(String.fromCharCode(...state)));
        msg("üíæ Save gravado");
      } catch(e){ msg("Erro ao salvar"); }
    };

    // Carregar do navegador
    document.getElementById("btnLoad").onclick = () => {
      const gm = window.EJS_emulator?.gameManager;
      if (!gm) return msg("Jogo n√£o iniciado.");
      const b64 = localStorage.getItem(LS_KEY);
      if (!b64) return msg("Nenhum save encontrado.");
      const u8 = new Uint8Array(atob(b64).split("").map(c=>c.charCodeAt(0)));
      try {
        gm.setState ? gm.setState(u8) : gm.loadState(u8);
        msg("üìÇ Save carregado");
      } catch(e){ msg("Erro ao carregar"); }
    };

    // Exportar save (.state)
    document.getElementById("btnExport").onclick = () => {
      const gm = window.EJS_emulator?.gameManager;
      if (!gm?.getState) return msg("Jogo n√£o iniciado.");
      try {
        const state = gm.getState();
        const blob = new Blob([state], {type:"application/octet-stream"});
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url; a.download = (window.EJS_gameName || "snes") + ".state";
        a.click(); URL.revokeObjectURL(url);
        msg("‚¨áÔ∏è Save baixado");
      } catch(e){ msg("Erro ao exportar"); }
    };

    // Importar save (.state)
    document.getElementById("btnImport").onclick = () =>
      document.getElementById("stateInput").click();

    document.getElementById("stateInput").addEventListener("change", async (ev) => {
      const file = ev.target.files?.[0];
      if (!file) return;
      const buf = new Uint8Array(await file.arrayBuffer());
      const gm = window.EJS_emulator?.gameManager;
      try {
        gm.setState ? gm.setState(buf) : gm.loadState(buf);
        msg("üì• Save importado");
      } catch(e){ msg("Erro ao importar"); }
    });
  </script>
</body>
</html>